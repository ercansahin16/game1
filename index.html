<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes, viewport-fit=cover">
<title>Manevi Bilgi Oyunu üåô</title>
<!-- Favicon -->
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üïå</text></svg>">
<!-- Font Awesome 6 -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<!-- Google Font: Poppins -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<!-- confetti -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1"></script>
<!-- howler.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
<!-- Sweet Alert 2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<style>
/* ---------- RESET & DEƒûƒ∞≈ûKENLER ---------- */
* {
margin:0;
padding:0;
box-sizing: border-box;
font-family:'Poppins', sans-serif;
}

:root {
--pastel-pink:#fbe9f0;
--pastel-green:#e0f2e6;
--accent:#7c3aed;
--accent-soft:#a78bfa;
--card-bg:rgba(255,255,255,0.8);
--text-dark:#1f2937;
--text-light:#f3f4f6;
--text-secondary:#6b7280;
--border-light:#e2e8f0;
--shadow:0 20px 40px rgba(0,0,0,0.05);
--border-radius-lg:48px;
--border-radius-md:24px;
--border-radius-sm:16px;
--transition: all 0.2s ease;
}

body {
background:linear-gradient(145deg,var(--pastel-pink),var(--pastel-green));
min-height:100vh;
display: flex;
justify-content: center;
align-items: center;
padding:16px;
transition: background 0.3s, color 0.2s;
color:var(--text-dark);
}

/* ========== DARK MODE ========= */
body.dark-theme {
background:linear-gradient(145deg,#0b1a2e,#04111f);
color:#ffffff;
}
body.dark-theme .game-container,
body.dark-theme .intro-card,
body.dark-theme .leaderboard-panel,
body.dark-theme .achievements-panel,
body.dark-theme .admin-panel,
body.dark-theme .game-over-card,
body.dark-theme .question-card,
body.dark-theme .option-btn,
body.dark-theme .level-badge,
body.dark-theme .score-box,
body.dark-theme .level-box,
body.dark-theme .,
body.dark-theme .intro-user-header,
body.dark-theme .hint-btn,
body.dark-theme .next-btn,
body.dark-theme .restart-btn,
body.dark-theme .timer,
body.dark-theme .intro-settings-panel,
body.dark-theme .avatar-option,
body.dark-theme .toast-message,
body.dark-theme .leaderboard-btn,
body.dark-theme .achievements-btn,
body.dark-theme .settings-btn,
body.dark-theme .exit-btn,
body.dark-theme .admin-left,
body.dark-theme .admin-right,
body.dark-theme .admin-question-item {
background:rgba(15,30,45,0.9) !important;
backdrop-filter:blur(10px);
border-color:#3a4a5a!important;
color:#ffffff!important;
box-shadow:0 6px 0 #1a2a3a!important;
}
body.dark-theme .leaderboard-panel,
body.dark-theme .achievements-panel,
body.dark-theme .admin-panel {
background:#1e293b!important;
border-color:#475569!important;
}
body.dark-theme .leaderboard-panel h2,
body.dark-theme .achievements-panel h2,
body.dark-theme .admin-panel h2,
body.dark-theme .admin-left h3,
body.dark-theme .admin-right h3 {
color:#a78bfa!important;
}
body.dark-theme .leaderboard-panel li,
body.dark-theme .achievements-panel li {
background:#0f172a!important;
color: white !important;
}
body.dark-theme .option-btn.correct { background:#0f4c2b!important; border-color:#2e7d5e!important; }
body.dark-theme .option-btn.wrong { background:#7a1f1f!important; border-color:#b33f3f!important; }
body.dark-theme .level-badge.active { background:#2c5f3a!important; }
body.dark-theme .level-badge.locked { background:#3a3a3a!important; color:#aaa!important; }
body.dark-theme .score-box i,
body.dark-theme .level-box i,
body.dark-theme . i,
body.dark-theme .intro-user-stats i,
body.dark-theme .leaderboard-btn i,
body.dark-theme .achievements-btn i,
body.dark-theme .settings-btn i,
body.dark-theme .exit-btn i { color:#ffd966!important; }
body.dark-theme .user-name,
body.dark-theme .score-box span,
body.dark-theme .level-box span,
body.dark-theme .question-text,
body.dark-theme .option-btn span,
body.dark-theme .toast-message,
body.dark-theme .leaderboard-btn span,
body.dark-theme .achievements-btn span,
body.dark-theme .settings-btn span,
body.dark-theme .exit-btn span,
body.dark-theme .admin-question-text,
body.dark-theme .admin-question-meta {
color:#ffffff!important;
}
body.dark-theme .toast-success { background:#0f4c2b!important; }
body.dark-theme .toast-info { background:#7a5c1f!important; }

/* ---------- INTRO EKRANI ---------- */
.intro-overlay {
position: fixed;
top:0; left:0; width:100%; height:100%;
background:rgba(0,0,0,0.2);
backdrop-filter:blur(12px);
display: flex;
justify-content: center;
align-items: center;
z-index:10000;
visibility: visible;
opacity:1;
transition:0.3s;
padding:16px;
}
.intro-overlay.hidden { visibility: hidden; opacity:0; pointer-events: none; }
.intro-card {
background:var(--card-bg);
backdrop-filter:blur(16px);
border-radius:var(--border-radius-lg);
padding:30px;
width:100%;
max-width:800px;
max-height:90vh;
overflow-y: auto;
box-shadow:0 30px 0 #ffe0b5, 0 20px 40px rgba(0,0,0,0.1);
border:4px solid #ffe8d9;
display: flex;
flex-direction: column;
gap:24px;
}
.intro-user-header {
display: flex;
align-items: center;
gap:10px;
background:rgba(255,255,255,0.4);
padding:10px 15px;
border-radius:80px;
border:2px solid #ffe0b0;
flex-wrap: wrap;
}
.intro-avatar {
width:50px;
height:50px;
border-radius:50%;
background:#ffe6c7;
display: flex;
align-items: center;
justify-content: center;
font-size:2rem;
border:3px solid white;
box-shadow:0 4px 0 #d4a373;
flex-shrink:0;
cursor: pointer;
transition: transform 0.2s;
user-select: none;
}
.intro-avatar:active {
transform: scale(0.95);
}
.intro-user-details {
flex:1;
min-width:140px;
}
.intro-user-name {
font-size:1.2rem;
font-weight:700;
color:#3a4e5e;
line-height:1.2;
}
.intro-user-stats {
font-size:0.85rem;
color:#6b7280;
display: flex;
gap:12px;
flex-wrap: wrap;
}

/*ayarlar*/
.intro-settings {
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
background: none;
border: none;
font-size:1.5rem;
color:#a78bfa;
cursor: pointer;
padding:5px;
transition: transform 0.2s;
line-height:1;
}

.intro-settings .settings-text {
font-size:0.7rem;
margin-top:2px;
color:var(--text-secondary);
font-weight:500;
}

.intro-settings:hover {
transform:rotate(90deg);
}

/* Dark mode uyumu (isteƒüe baƒülƒ±) */
body.dark-theme .intro-settings .settings-text {
color:#ffd966;
}

.intro-stats {
display: grid;
grid-template-columns:1fr 1fr;
gap:20px;
margin-top:10px;
}
.intro-leaderboard-preview, .intro-achievements-preview {
background:rgba(255,255,255,0.5);
border-radius:var(--border-radius-md);
padding:16px;
border:2px solid #ffe0b0;
max-height:200px;
overflow-y: auto;
word-break: break-word;
}
.intro-leaderboard-preview h4, .intro-achievements-preview h4 {
display: flex;
align-items: center;
gap:8px;
color:#7c3aed;
margin-bottom:12px;
font-size:1.1rem;
}
.intro-leaderboard-preview ul, .intro-achievements-preview ul {
font-size:0.85rem;
}
.intro-leaderboard-preview li, .intro-achievements-preview li {
white-space: nowrap;
overflow: hidden;
text-overflow: ellipsis;
}

/* YENƒ∞: En ƒ∞yisini G√∂r Butonu Stili */
.view-leaderboard-btn {
width: 100%;
background: linear-gradient(135deg, #ffe69b 0%, #ffd966 100%);
border: none;
border-radius: 60px;
font-size: 1rem;
font-weight: 600;
font-weight: 600;
color: #5e4b3c;
display: flex;
align-items: center;
justify-content: center;
gap: 15px;
box-shadow: 0 6px 0 #d4a373;
cursor: pointer;
transition: all 0.2s;
padding-top: 8px;
padding-bottom: 8px;
margin-top: 10px;
border: 3px solid #ffe0b0;
}

.view-leaderboard-btn:hover {
transform: translateY(-3px);
box-shadow: 0 9px 0 #d4a373;
}

.view-leaderboard-btn:active {
transform: translateY(0);
box-shadow: 0 3px 0 #d4a373;
}

.view-leaderboard-btn i {
font-size: 1.2rem;
color: #ff9f1c;
}

.intro-play-btn {
background:#ffe69b;
border: none;
border-radius:80px;
padding:16px 25px;
font-size:1.5rem;
font-weight:700;
color:#5e4b3c;
display: flex;
align-items: center;
justify-content: center;
gap:12px;
box-shadow:0 10px 0 #d4a373;
cursor: pointer;
transition:0.1s;
width:100%;
border:3px solid #ffe0b0;
}
.intro-play-btn:hover { transform:translateY(-4px); box-shadow:0 14px 0 #d4a373; }
.intro-settings-panel { background: white; border-radius:var(--border-radius-md); padding:20px; border:3px solid #ffe0b0; margin-top:10px; }
.intro-settings-panel input { width:100%; padding:12px; border-radius:60px; border:2px solid #ffe0b0; font-size:0.95rem; margin-bottom:15px; }
.avatar-selector { display: flex; flex-wrap: wrap; gap:10px; justify-content: center; margin:15px 0; }
.avatar-option { width:60px; height:60px; border-radius:50%; border:4px solid #ffe0b0; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size:2rem; background:#fef9e0; transition:0.1s; }
.avatar-option.selected { border-color:#7c3aed; transform:scale(1.1); box-shadow:0 0 0 4px rgba(124,58,237,0.3); }

/* ---------- OYUN KONTEYNERƒ∞ ‚Äì TEK SATIR √úST PANEL ---------- */
.game-container {
background:var(--card-bg);
backdrop-filter:blur(10px);
border-radius:var(--border-radius-lg);
padding:20px;
box-shadow:var(--shadow);
border:1px solid rgba(255,255,255,0.5);
width:100%;
max-width:1000px;
margin:0 auto;
transition:0.3s;
margin-top:-%10;
}

/* TEK SATIR √úST PANEL */
. {
display: flex;
align-items: center;
justify-content: space-between;
gap:8px;
margin-bottom:16px;
background:rgba(255,255,255,0.4);
padding:6px 12px;
border-radius:60px;
border:2px solid #ffe0b0;
flex-wrap: wrap;
}

.left-group {
display: flex;
align-items: center;
gap:10px;
flex-shrink:0;
}

.user-avatar {
width:40px;
height:40px;
border-radius:50%;
background:#ffe6c7;
display: flex;
align-items: center;
justify-content: center;
font-size:1.8rem;
border:2px solid white;
box-shadow:0 3px 0 #d4a373;
flex-shrink:0;
}

.user-name {
font-weight:700;
font-size:1rem;
color:var(--text-dark);
white-space: nowrap;
overflow: hidden;
text-overflow: ellipsis;
max-width:120px;
}

.right-group {
display: flex;
align-items: center;
gap:6px;
flex-wrap: wrap;
margin-left: auto;
}

.stat-box {
background: white;
padding:4px 10px;
border-radius:30px;
box-shadow:0 3px 0 #cbd5e0;
border:1px solid #cbd5e0;
font-weight:600;
display: flex;
align-items: center;
gap:4px;
color:#2d3e50;
font-size:0.8rem;
}

.stat-box i {
color:#ff9f1c;
font-size:0.9rem;
}

.action-btn {
background:rgba(255,255,255,0.7);
border:2px solid #ffe0b0;
border-radius:30px;
padding:4px 10px;
font-size:0.8rem;
cursor: pointer;
display: flex;
align-items: center;
gap:4px;
color:#4a5a6a;
transition:0.1s;
white-space: nowrap;
}

.action-btn i {
font-size:0.9rem;
}

/* Seviye g√∂stergeleri */
.levels-wrapper {
overflow-x: auto;
margin-bottom:20px;
padding-bottom:5px;
-webkit-overflow-scrolling: touch;
}
.levels-container {
display: flex;
gap:10px;
background:rgba(255,255,255,0.4);
padding:12px;
border-radius:60px;
min-width: min-content;
transform: translateY(-20%);
}
.level-badge {
width:50px;
height:50px;
border-radius:50%;
background: white;
display: flex;
justify-content: center;
align-items: center;
font-weight:700;
font-size:1.3rem;
color:#2d3e50;
box-shadow:0 5px 0 #b0c4ce;
border:2px solid #ffe9e9;
flex-shrink:0;
}
.level-badge.active {
background:#b5e6c3;
box-shadow:0 5px 0 #6b9e7a;
color:#1e3a2f;
}
.level-badge.locked {
background:#e0e0e0;
box-shadow:0 5px 0 #adadad;
color:#7e7e7e;
opacity:0.7;
}
.level-badge.locked i {
font-size:1.4rem;
}

/* Soru kartƒ± */
.question-card {
background: white;
border-radius:32px;
padding:25px 20px;
margin-bottom:20px;
margin-top:25px;
box-shadow:0 8px 0 #e2e8f0;
border:2px solid #edf2f7;
position: relative;
}
.question-text {
font-size:1.4rem;
font-weight:600;
color:#2d3e50;
line-height:1.4;
margin-bottom:8px;

word-break: break-word;
padding-right:70px;
}
.timer {
position: absolute;
top:-25px;
right:20px;
background:#ffe2cc;
border-radius:30px;
padding:5px 12px;
font-weight:700;
font-size:1rem;
display: flex;
align-items: center;
gap:5px;
border:2px solid #ffb08c;
box-shadow:0 3px 0 #d48c6b;
color:#5e3e2e;
}
.hint-btn {
background:#ffeaa5;
border: none;
border-radius:30px;
padding:5px 10px;
font-size:1rem;
font-weight:600;
color:#6b4f1a;
display: flex;
align-items: center;
gap:8px;
margin:0 auto 15px;
box-shadow:0 5px 0 #d4a373;
cursor: pointer;
transition:0.1s;
}
.hint-btn.disabled {
opacity:0.5;
pointer-events: none;
}
.options-grid {
display: grid;
grid-template-columns:repeat(2,1fr);
gap:12px;
margin-bottom:20px;
}
.option-btn {
            background: #fff6e6;
            border: 3px solid #ffdab9;
            border-radius: 16px;
            padding: 12px;
            font-size: 0.95rem;
            font-weight: 500;
            color: #3a4e5e;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 0 #e6c4a8;
            cursor: pointer;
            transition: 0.1s;
            word-break: break-word;
            text-align: left;
            line-height: 1.3;
        }
.option-btn.correct {
            background: #c8e6c9;
            border-color: #81c784;
            box-shadow: 0 4px 0 #519657;
        }
.option-btn.wrong {
            background: #ffcdd2;
            border-color: #e57373;
            box-shadow: 0 4px 0 #b71c1c;
        }
 .option-btn.eliminated {
            opacity: 0.3;
            pointer-events: none;
            background: #ccc;
            border-color: #999;
            text-decoration: line-through;
        }
.next-btn {
            background: #b2d8d8;
            border: none;
            border-radius: 30px;
            padding: 12px 25px;
            font-size: 1rem;
            font-weight: 600;
            color: #1e4a4a;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 8px auto 0;
            width: 100%;
            max-width: 200px;
            box-shadow: 0 5px 0 #6b9e9e;
            cursor: pointer;
            border: 2px solid #c0e0e0;
        }
.next-btn.active {
            background: #ffe69b;
            box-shadow: 0 5px 0 #d4a373;
            color: #5e4b3c;
        }
.next-btn.disabled {
            opacity: 0.4;
            pointer-events: none;
        }
/* Game Over Modal */
        .game-over-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.2);
            backdrop-filter: blur(8px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10001;
            visibility: hidden;
            opacity: 0;
            transition: 0.2s;
        }
 .game-over-modal.active {
            visibility: visible;
            opacity: 1;
        }

        .game-over-card {
            background: white;
            border-radius: 32px;
            padding: 25px;
            max-width: 350px;
            width: 90%;
            text-align: center;
            box-shadow: 0 15px 0 #ffe0b5;
            border: 3px solid #ffe8d9;
        }
.restart-btn {
background:#ffb7b7;
border: none;
border-radius:50px;
padding:12px 25px;
font-size:1.1rem;
font-weight:600;
color:#631e1e;
box-shadow:0 6px 0 #b47272;
cursor: pointer;
display: inline-flex;
gap:8px;
}

/* ========== ADMIN PANELƒ∞ ‚Äì YENƒ∞ ƒ∞STATƒ∞STƒ∞K ALANI ========= */
.admin-panel {
position: fixed;
top:50%; left:50%; transform:translate(-50%,-50%);
background: white;
border-radius:48px;
padding:25px;
max-width:1000px;
width:95%;
max-height:90vh;
overflow-y: auto;
z-index:10002;
box-shadow:0 20px 0 #ffe0b5;
border:4px solid #ffe8d9;
visibility: hidden;
opacity:0;
transition:0.2s;
}
.admin-panel.active { visibility: visible; opacity:1; }
.admin-split { display: grid; grid-template-columns:1fr 1fr; gap:20px; margin-top:20px; }
.admin-left, .admin-right {
background:#fef9e0;
border-radius:var(--border-radius-md);
padding:20px;
border:2px solid #ffe0b0;
}
.admin-left { max-height:500px; overflow-y: auto; }
.admin-left h3, .admin-right h3 {
display: flex;
align-items: center;
gap:8px;
color:#7c3aed;
margin-bottom:15px;
font-size:1.2rem;
}
.admin-stats {
background:#ffe6c7;
border-radius:20px;
padding:12px;
margin-bottom:20px;
border:1px solid #ffb08c;
font-size:0.9rem;
color:#5e3e2e;
display: flex;
flex-direction: column;
gap:8px;
}
.admin-stats p {
display: flex;
justify-content: space-between;
margin:0;
}
.admin-question-item {
background: white;
border-radius:20px;
padding:10px 12px;
margin-bottom:12px;
border:1px solid #ffe0b0;
display: flex;
flex-direction: column;
gap:6px;
}
.admin-question-header {
display: flex;
justify-content: space-between;
align-items: center;
}
.admin-question-text {
font-weight:600;
font-size:0.9rem;
color:#2d3e50;
word-break: break-word;
flex:1;
}
.admin-question-actions { display: flex; gap:8px; }
.admin-question-actions button {
background: none;
border: none;
font-size:1.1rem;
cursor: pointer;
padding:5px;
border-radius:8px;
transition:0.1s;
}
.admin-question-actions button:hover { background:rgba(124,58,237,0.1); }
.admin-question-meta {
display: flex;
gap:12px;
font-size:0.75rem;
color:#6b7280;
}
.admin-right input, .admin-right select {
width:100%;
padding:10px;
margin-bottom:12px;
border:2px solid #ffe0b0;
border-radius:60px;
font-size:0.9rem;
}
.admin-right .btn-group {
display: flex;
gap:10px;
margin-top:10px;
}
.admin-right button {
flex:1;
background:#b5e6c3;
border: none;
border-radius:60px;
padding:12px;
font-weight:600;
color:#1e3a2f;
box-shadow:0 5px 0 #6b9e7a;
cursor: pointer;
transition:0.1s;
display: flex;
align-items: center;
justify-content: center;
gap:6px;
}
.admin-right button#cancelEditBtn {
background:#ffe0b0;
box-shadow:0 5px 0 #d4a373;
color:#5e4b3c;
}
.admin-right button:hover { transform:translateY(-2px); box-shadow:0 7px 0 #6b9e7a; }
.admin-right button#cancelEditBtn:hover { box-shadow:0 7px 0 #d4a373; }
.admin-clear-btn {
background:#ffb7b7!important;
box-shadow:0 5px 0 #b47272!important;
color:#631e1e!important;
margin-top:12px;
width:100%;
padding:12px;
border: none;
border-radius:60px;
font-weight:600;
display: flex;
align-items: center;
justify-content: center;
gap:8px;
cursor: pointer;
transition:0.1s;
}
.admin-clear-btn:hover { transform:translateY(-2px); box-shadow:0 7px 0 #b47272!important; }
.admin-bulk-btn {
background:#b5e6c3!important;
box-shadow:0 5px 0 #6b9e7a!important;
color:#1e3a2f!important;
margin-top:12px;
min-width:220px;
}

/* Liderlik, ba≈üarƒ±mlar panelleri */
.leaderboard-panel, .achievements-panel {
position: fixed;
top:50%; left:50%; transform:translate(-50%,-50%);
background: white;
border-radius:48px;
padding:25px;
max-width:450px;
width:90%;
max-height:80vh;
overflow-y: auto;
z-index:10002;
box-shadow:0 20px 0 #ffe0b5;
border:4px solid #ffe8d9;
visibility: hidden;
opacity:0;
transition:0.2s;
}
.leaderboard-panel.active, .achievements-panel.active { visibility: visible; opacity:1; }
.leaderboard-panel li, .achievements-panel li {
background:#fef9e0;
border-radius:40px;
padding:10px;
margin-bottom:8px;
display: flex;
align-items: center;
word-break: break-word;
font-size:0.9rem;
}

/* Maskot, ses butonu */
.mascot { position: fixed; bottom:15px; left:15px; width:70px; z-index:10000; cursor: pointer; }
.swal2-container {z-index: 100000 !important;}
.speech-bubble { position: absolute; bottom:80px; left:10px; background: white; padding:8px 12px; border-radius:30px 30px 30px 5px; font-size:0.85rem; max-width:150px; box-shadow:0 5px 0 #d4a373; border:2px solid #ffe0b0; display: none; }
.speech-bubble.active { display: block; }
.sound-toggle { position: fixed; bottom:15px; right:15px; background: white; border:2px solid #ffe0b0; border-radius:50%; width:50px; height:50px; display: flex; align-items: center; justify-content: center; font-size:1.4rem; color:#7c3aed; cursor: pointer; z-index:1000; box-shadow:0 5px 0 #d4a373; }

/* Toast mesajlarƒ± */
.toast-message {
position: fixed;
top:15px;
left:50%;
transform:translateX(-50%);
background: white;
color:#2d3e50;
padding:10px 20px;
border-radius:50px;
font-weight:600;
font-size:0.9rem;
box-shadow:0 8px 15px rgba(0,0,0,0.1);
display: flex;
align-items: center;
gap:10px;
z-index:100000;
border:2px solid #ffe0b0;
backdrop-filter:blur(4px);
animation: slideDown 0.3s;
}
.toast-success { background:#d4edda; border-color:#a3d0b1; color:#0b5e42;z-index:100000; }
.toast-info { background:#fff3cd; border-color:#ffe69b; color:#856404;z-index:100000; }

              /* Modal Ayarlar */
        .settings-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(8px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10001;
            padding: 10px;
        }

        .settings-modal-overlay.active {
            display: flex;
        }
            .settings-modal {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 25px;
            width: 100%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 0 #ffe0b5;
            border: 4px solid #ffe8d9;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .settings-modal h4 {
            color: #7c3aed;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .settings-modal input {
            width: 100%;
            padding: 12px 15px;
            border-radius: 50px;
            border: 2px solid #ffe0b0;
            font-size: 0.95rem;
            margin-bottom: 15px;
            outline: none;
        }

        .settings-modal input:focus {
            border-color: #7c3aed;
        }

        .avatar-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }

        .avatar-option {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            border: 4px solid #ffe0b0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            background: #fef9e0;
            transition: 0.1s;
        }

        .avatar-option.selected {
            border-color: #7c3aed;
            transform: scale(1.1);
            box-shadow: 0 0 0 4px rgba(124,58,237,0.3);
        }

        .settings-modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .settings-modal-buttons button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.1s;
        }

        .btn-save {
            background: #a5d6b7;
            box-shadow: 0 6px 0 #6b8c7e;
            color: #1e3a2f;
        }

        .btn-close {
            background: #ffe0b0;
            box-shadow: 0 6px 0 #d4a373;
            color: #5e4b3c;
        }
            
.right-group .stat-box,
.right-group .action-btn {
  flex: 1 1 0;         /* e≈üit geni≈ülik */
  min-width: 45px;     /* √ßok k√º√ß√ºlmesin */
  text-align: center;
  justify-content: center;
  padding: 6px 10px;   /* biraz b√ºy√ºt */
  font-size: 0.9rem;
}

@keyframes slideDown { from { top:-50px; opacity:0; } to { top:15px; opacity:1; } }

/* Responsive iyile≈ütirmeler */
@media (max-width:768px) {
.hint-btn {padding: 2px 6px;font-size: 0.75rem;gap: 3px;border-radius: 18px; }
.admin-split { grid-template-columns:1fr; }
.admin-left { max-height:300px; }
.game-container { padding:15px; transform: translateY(-5%);}
.intro-card { transform: translateY(-5%);}
.question-text { font-size:1.1rem; padding-right:60px; }
.intro-stats { grid-template-columns:1fr; }
. { padding:5px 10px; }
.user-avatar { width:35px; height:35px; font-size:1.6rem; }
.user-name { max-width:100px; }
.stat-box { padding:3px 8px; font-size:0.75rem; }
.stat-box i { font-size:0.8rem; }
.action-btn { padding:3px 8px; font-size:0.75rem; }
.action-btn i { font-size:0.8rem; }
.action-btn span { display: none; } /* mobilde sadece ikon */
.right-group > * padding: 6px 8px;        /* biraz k√º√ß√ºlt */font-size: 0.85rem;      /* yazƒ± boyutunu azalt */min-width: 40px;}
}
@media (max-width:600px) {
.hint-btn {padding: 1px 5px;font-size: 0.7rem;gap: 2px;border-radius: 16px;box-shadow: 0 2px 0 #d4a373; }
.options-grid { grid-template-columns:1fr; }
.game-container { padding:15px; transform: translateY(-5%);}
.intro-card { transform: translateY(-5%);}
. { flex-wrap: wrap; }

}
@media (max-width:480px) {
body { padding:8px; }
.game-container { padding:12px; transform: translateY(-5%);}
.intro-card { transform: translateY(-5%);}
.question-text { font-size:1.2rem; padding-right:0; }
.timer { position: relative; top:0; right:0; margin-bottom:-20px; width: fit-content; }
.next-btn { width:100%; }
.level-badge { width:45px; height:45px; font-size:1.1rem; }
.mascot { width:60px; bottom:10px; left:10px;z-index:10000; }
.sound-toggle { width:45px; height:45px; font-size:1.3rem; bottom:10px; right:10px; }
.right-group > * {padding: 5px 6px; /* daha da k√º√ß√ºlt */font-size: 0.8rem; min-width: 35px;}
.hint-btn {padding: 1px 4px; font-size: 0.65rem; gap: 2px; border-radius: 14px; }
.hint-btn i {font-size: 0.7rem; }
}


.top-bar { display: flex; align-items: center; gap:8px; flex-wrap: wrap; }
.left-group { flex-shrink:0; display:flex; align-items:center; gap:8px; }

            
.right-group2 {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;

  /* Border ve yazƒ± boyutu */
  border: 2px solid #ffd966;    /* ƒ∞stediƒüiniz renk ve kalƒ±nlƒ±k */
  font-size: 1rem;              /* Yazƒ± boyutu (ayarlayabilirsiniz) */

  /* Bo≈üluklarƒ± kaldƒ±r */
  padding: 0;
  margin: 0;

  /* ƒ∞√ßeriƒüi saƒüa yasla */
  text-align: right;

  /* Eƒüer elementi bulunduƒüu satƒ±rda en saƒüa yaslamak isterseniz */
  margin-left: auto;             /* Bu satƒ±rƒ± kaldƒ±rabilirsiniz */
}


.info-bubble {
   position: fixed;
  top: 12px;
  left: 50%;
  transform: translateX(-50%) translateY(-20px);
  background: #111827;
  color: #fff;
  padding: 10px 14px;
  border-radius: 14px;
  font-size: 13px;
  max-width: calc(100vw - 24px);
  text-align: center;
  z-index: 9999;
  opacity: 0;
  pointer-events: none;
  transition: all .25s ease;
  box-shadow: 0 10px 25px rgba(0,0,0,.25);
}
            /* OK */
.info-bubble.active{
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}


</style>
</head>
<body>

<!-- ========== INTRO EKRANI ========= -->
<div id="introOverlay" class="intro-overlay">
<div class="intro-card">
<div class="intro-user-header">
<div id="introAvatar" class="intro-avatar">üêª</div>
<div class="intro-user-details">
<div id="introUserName" class="intro-user-name">Misafir</div>
<div id="introUserStats" class="intro-user-stats">
<span><i class="fas fa-crown"></i> Seviye <span id="introLevel">1</span></span>
<span><i class="fas fa-star"></i> Puan <span id="introScore">0</span></span>
</div>
</div>
<button id="introSettingsBtn" class="intro-settings">
<i class="fas fa-cog"></i>
<span class="settings-text">Ayarlar</span>
</button>
  
</div>
<div class="intro-stats">
<!-- DEƒûƒ∞≈ûTƒ∞: En ƒ∞yi Performans b√∂l√ºm√º -->
<div class="intro-leaderboard-preview">
<h4><i class="fas fa-trophy"></i> En ƒ∞yi Kim ?</h4>
<p style="color: #6b7280; font-size: 0.85rem; margin-bottom: 5px;">En y√ºksek puanlarƒ± g√∂r√ºp kendini challange et!</p>
<button id="viewLeaderboardBtn" class="view-leaderboard-btn">
<i class="fas fa-trophy"></i> Lideri G√∂r
</button>
</div>
<div class="intro-achievements-preview">
<h4><i class="fas fa-medal"></i>Rozetlerim</h4>
<div id="introAchievementsList">Y√ºkleniyor...</div>
</div>
</div>
<button id="introStartGameBtn" class="intro-play-btn"><i class="fas fa-play-circle"></i> BA≈ûLA</button>

            <!-- Settings Modal -->
    <div id="settingsModalOverlay" class="settings-modal-overlay">
        <div class="settings-modal">
            <h4><i class="fas fa-user-edit"></i> Profil Ayarlarƒ±</h4>
            <input type="text" id="settingsUsername" placeholder="Adƒ±n Soyadƒ±n" value="Misafir">
            <div style="font-weight: 600; margin-bottom: 10px; font-size: 0.9rem;">Avatar Se√ß:</div>
            <div id="settingsAvatarSelector" class="avatar-selector"></div>
            <div class="settings-modal-buttons">
                <button id="saveSettingsBtn" class="btn-save">Kaydet</button>
                <button id="closeSettingsBtn" class="btn-close">Kapat</button>
            </div>
        </div>
    </div>
<div id="introSettingsPanel" class="intro-settings-panel" style="display: none;">
<h4><i class="fas fa-user-edit"></i> Profil Ayarlarƒ±</h4>
<input type="text" id="settingsUsername" placeholder="Adƒ±n Soyadƒ±n" value="Misafir">
<div style="font-weight: 600; margin-bottom: 10px;">Avatar Se√ß:</div>
<div id="settingsAvatarSelector" class="avatar-selector"></div>
<div style="display: flex; gap: 15px; margin-top: 15px;">
<button id="saveSettingsBtn" class="restart-btn" style="background: #a5d6b7; box-shadow: 0 8px 0 #6b8c7e; color: #1e3a2f;">Kaydet</button>
<button id="closeSettingsBtn" class="restart-btn" style="background: #ffe0b0; box-shadow: 0 8px 0 #d4a373; color: #5e4b3c;">Kapat</button>
</div>
</div>
</div>
</div>

<!-- ========== ANA OYUN KONTEYNERƒ∞ ‚Äì YENƒ∞ √úST PANEL ========= -->
<div id="gameContainer" class="game-container" style="display: none;">
<!-- TEK SATIR √úST PANEL -->
<div class="top-bar">
<div class="left-group">
<div id="gameAvatar" class="user-avatar">üêª</div>
<div id="gameUserName" class="user-name">Misafir</div><!-- kullanƒ±cƒ± acƒ± -->
</div>
<div id="levelProgress" class="right-group2 stat-box" ></div><!-- kalan soru sayƒ±sƒ± bilgisi -->
 <!--balon i√ßeriƒüi -->
<div id="infoBubble" class="info-bubble" style="display: none;"></div>
            
<div class="right-group"><!-- seviye puan rozet ba≈üarƒ± bilgileri -->
<div class="stat-box"><i class="fas fa-star"></i><span id="scoreDisplay">0</span></div>
<div class="stat-box"><i class="fas fa-crown"></i><span id="currentLevelDisplay">1</span></div>
<button id="leaderboardBtn" class="action-btn" title="Liderlik"><i class="fas fa-trophy"></i><span>Liderlik</span></button>
<button id="achievementsBtn" class="action-btn" title="Ba≈üarƒ±mlar"><i class="fas fa-medal"></i><span>Ba≈üarƒ±mlar</span></button>
<button id="settingsBtn" class="action-btn" title="Tema"><i class="fas fa-moon"></i><span>Tema</span></button>
<button id="exitGameBtn" class="action-btn" title="Oyundan √áƒ±k"><i class="fas fa-sign-out-alt"></i><span>√áƒ±k</span></button>
</div>
</div>

<!-- Seviye g√∂stergeleri -->
<div class="levels-wrapper">
<div id="levelIndicators" class="levels-container"></div>
</div>

<!-- Soru kartƒ± -->
<div id="questionCard" class="question-card">
<!-- √úst satƒ±r: Timer solda, ƒ∞pucu saƒüda -->
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;margin-top:-50px;">
<div id="timer" class="timer" style="position: relative; top: 0; right: 0;margin: 0;">
<i class="fas fa-hourglass-half"></i>
<span id="timerSeconds">60</span>sn
</div>
<button id="hintButton" class="hint-btn" style="margin: 0;">
<i class="fas fa-lightbulb"></i> ƒ∞pucu (5 puan)
</button>
</div>
<div id="questionText" class="question-text">Soru y√ºkleniyor...</div>
<div id="optionsContainer" class="options-grid"></div>
<div style="display: flex; gap: 10px; justify-content: center;">
<button id="nextButton" class="next-btn disabled"><i class="fas fa-arrow-right"></i> ƒ∞leri</button>
</div>
</div>
</div>

<!-- ========== Lƒ∞DERLƒ∞K PANELƒ∞ ========= -->
<div id="leaderboardPanel" class="leaderboard-panel">
<h2 style="color: #7c3aed; margin-bottom: 20px;"><i class="fas fa-trophy"></i> En ƒ∞yiler</h2>
<div id="leaderboardList" style="margin-bottom: 20px;">Y√ºkleniyor...</div>
<button id="closeLeaderboardBtn" class="restart-btn" style="background: #ffe0b0; color: #5e4b3c;">Kapat</button>
</div>

<!-- ========== BA≈ûARIM PANELƒ∞ ========= -->
<div id="achievementsPanel" class="achievements-panel">
<h2 style="color: #7c3aed; margin-bottom: 20px;"><i class="fas fa-medal"></i> Rozetlerim</h2>
<div id="achievementsList">Y√ºkleniyor...</div>
<button id="closeAchievementsBtn" class="restart-btn" style="background: #ffe0b0; color: #5e4b3c; margin-top: 20px;">Kapat</button>
</div>

<!-- ========== ADMIN PANELƒ∞ ‚Äì YENƒ∞ ƒ∞STATƒ∞STƒ∞K ALANI ========= -->
<div id="adminPanel" class="admin-panel">
<h2 style="color: #7c3aed; text-align: center; margin-bottom: 10px;"><i class="fas fa-lock"></i> Admin ‚Äì Soru Y√∂netimi</h2>
<div class="admin-split">
<div class="admin-left">
<h3><i class="fas fa-list"></i> Mevcut Sorular</h3>
<div id="adminStats" class="admin-stats">
<!-- JS ile doldurulacak -->
</div>
<div id="adminQuestionsList">
<p style="color: #6b7280; text-align: center;">Y√ºkleniyor...</p>
</div>
<button id="clearLeaderboardBtn" class="admin-clear-btn">
<i class="fas fa-trash-alt"></i> Liderlik Tablosunu Temizle
</button>
<button id="resetAllUserDataBtn" class="admin-clear-btn" style="margin-top: 10px; background: #b34180 !important; box-shadow: 0 5px 0 #7a2d5a !important; color: white !important;">
<i class="fas fa-eraser"></i> T√ºm Kullanƒ±cƒ± Verilerini Sƒ±fƒ±rla
</button>
<button id="bulkAddQuestionsBtn" class="admin-clear-btn admin-bulk-btn" style="margin-top: 10px;">
<i class="fas fa-database"></i><span class="btn-text">Toplu Soru Ekle</span>
<span class="loading-spinner" style="display: none;"><i class="fas fa-spinner fa-pulse"></i> Y√ºkleniyor...</span>
</button>
</div>
<div class="admin-right">
<h3 id="formTitle"><i class="fas fa-plus-circle"></i> Yeni Soru Ekle</h3>
<input type="text" id="adminSoru" placeholder="Soru metni">
<input type="text" id="adminSecenek1" placeholder="≈ûƒ±k A">
<input type="text" id="adminSecenek2" placeholder="≈ûƒ±k B">
<input type="text" id="adminSecenek3" placeholder="≈ûƒ±k C">
<input type="text" id="adminSecenek4" placeholder="≈ûƒ±k D">
<select id="adminDogru">
<option value="0">≈ûƒ±k A doƒüru</option><option value="1">≈ûƒ±k B doƒüru</option>
<option value="2">≈ûƒ±k C doƒüru</option><option value="3">≈ûƒ±k D doƒüru</option>
</select>
<select id="adminKategori">
<option value="Kur'an">Kur'an</option><option value="Namaz">Namaz</option><option value="Peygamberler">Peygamberler</option>
<option value="ƒ∞slam Dini">ƒ∞slam Dini</option>
<option value="Melekler">Melekler</option>
<option value="Cennet-Cehennem">Cennet-Cehennem</option>
<option value="Allah">Allah</option>
</select>
<select id="adminZorluk">
<option value="1">Kolay</option><option value="2">Orta</option><option value="3">Zor</option>
</select>
<div class="btn-group">
<button id="saveQuestionBtn"><i class="fas fa-save"></i> Soruyu Kaydet</button>
<button id="cancelEditBtn" style="display: none;"><i class="fas fa-times"></i> ƒ∞ptal</button>
</div>
</div>
</div>
<div style="text-align: center; margin-top: 25px;">
<button id="closeAdminBtn" class="restart-btn" style="background: #ffe0b0; box-shadow: 0 8px 0 #d4a373; color: #5e4b3c; padding: 12px 25px;">Admin Panelini Kapat</button>
</div>
</div>

<!-- ========== OYUN Bƒ∞TTƒ∞ MODAL ========= -->
<div id="gameOverModal" class="game-over-modal">
<div class="game-over-card">
<h2><i class="fas fa-heart-crack"></i> Oyun Bitti</h2>
<p id="gameOverMessage">ƒ∞kinci hakkƒ±nda da yanlƒ±≈ü cevap verdin.</p>
<button id="restartGameBtn" class="restart-btn"><i class="fas fa-rotate-left"></i> Seviyeyi Tekrarla</button>
</div>
</div>

<!-- ========== MASKOT & SES ========= -->
<div id="mascot" class="mascot">
<img src="https://cdn-icons-png.flaticon.com/512/1995/1995575.png" alt="Bayku≈ü" style="width:100%;z-index:10000;">
<div id="speechBubble" class="speech-bubble" style="z-index:10000;">Merhaba! üëã</div>
</div>
<div id="soundToggleBtn" class="sound-toggle">
<i class="fas fa-volume-up"></i>
</div>
<div id="toastContainer"></div>

<script type="module">
// ------------------------------------------------------------
// FIREBASE IMPORTLAR
// ------------------------------------------------------------
import { db } from './firebase-core.js';
import {
collection, getDocs, addDoc, query, orderBy, limit,
doc, getDoc, updateDoc, deleteDoc, where,
writeBatch
} from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';

// ------------------------------------------------------------
// SABƒ∞TLER
// ------------------------------------------------------------
const QUESTIONS_COLLECTION = 'manevi_sorular';
const LEADERBOARD_COLLECTION = 'leaderboard';
const ADMIN_PASSWORD = 'admin123';
const STORAGE_KEY = 'maneviOyunSave';

// ----- 169 SORU (kƒ±saltƒ±ldƒ±, ger√ßek kodda tam liste olacak) -----
const SAMPLE_QUESTIONS = [
{bolum: 'Kur\'an', soru: 'Kur\'an-ƒ± Kerim ka√ß c√ºzden olu≈üur?', secenekler: ['28','29','30','31'], dogru: 2, zorluk: 1},
{bolum: 'Kur\'an', soru: 'Hangi sure Kur\'an\'ƒ±n kalbi olarak bilinir?', secenekler: ['Fatiha','Yasin','Rahman','M√ºlk'], dogru: 1, zorluk: 2},
{bolum: 'Kur\'an', soru: 'Kur\'an\'da adƒ± ge√ßen tek sahabe kimdir?', secenekler: ['Ebu Bekir','√ñmer','Zeyd','√úsame'], dogru: 2, zorluk: 2},
//SORU EKLEME B√ñL√úM√ú
//Ercan ≈üahin notlarƒ±dƒ±r: Buraya sorularƒ± ekle, sonra adminden toplu soru ekle butonu tƒ±kla.
//daha sonra burdaki sorularƒ± kaldƒ±rabilirsin. √ßunku sorular firestore kaydoluyor.

];

const AVATAR_LIST = [
{name: 'Ma≈üa', icon: 'üêª', img: 'https://cdn-icons-png.flaticon.com/512/1995/1995575.png'},
{name: 'Koca Ayƒ±', icon: 'üê®', img: 'https://cdn-icons-png.flaticon.com/512/616/616412.png'},
{name: 'Sonic', icon: 'ü¶î', img: 'https://cdn-icons-png.flaticon.com/512/1995/1995575.png'},
{name: 'Labubi', icon: 'üê∂', img: 'https://cdn-icons-png.flaticon.com/512/616/616408.png'},
{name: 'Mickey', icon: 'üê≠', img: 'https://cdn-icons-png.flaticon.com/512/1995/1995575.png'},
{name: 'Minnie', icon: 'üê≠', img: 'https://cdn-icons-png.flaticon.com/512/1995/1995575.png'},
{name: 'Donald', icon: 'ü¶Ü', img: 'https://cdn-icons-png.flaticon.com/512/1995/1995575.png'},
{name: 'Goofy', icon: 'üêï', img: 'https://cdn-icons-png.flaticon.com/512/1995/1995575.png'},
];

// ------------------------------------------------------------
// SES Sƒ∞STEMƒ∞
// ------------------------------------------------------------
let soundEnabled = true;
const sounds = {
correct: new Howl({src: ['https://cdn.freesound.org/previews/320/320655_5260872-lq.mp3']}),
levelUp: new Howl({src: ['https://cdn.freesound.org/previews/411/411089_5121236-lq.mp3']})
};
function playBeep(type){
if(!soundEnabled) return;
try{
const audioCtx = new(window.AudioContext || window.webkitAudioContext)();
if(audioCtx.state === 'suspended') audioCtx.resume().then(() => createBeep(audioCtx, type));
else createBeep(audioCtx, type);
}catch(e){}
}
function createBeep(audioCtx, type){
const osc = audioCtx.createOscillator();
const gain = audioCtx.createGain();
osc.connect(gain);
gain.connect(audioCtx.destination);
switch(type){
case 'wrong':
osc.frequency.setValueAtTime(300, audioCtx.currentTime);
gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.3);
osc.start(); osc.stop(audioCtx.currentTime + 0.3);
break;
case 'gameOver':
osc.frequency.setValueAtTime(200, audioCtx.currentTime);
gain.gain.setValueAtTime(0.25, audioCtx.currentTime);
gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.5);
osc.start(); osc.stop(audioCtx.currentTime + 0.5);
break;
case 'hint':
osc.frequency.setValueAtTime(600, audioCtx.currentTime);
gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.2);
osc.start(); osc.stop(audioCtx.currentTime + 0.2);
break;
}
}
function playSound(soundName){
if(!soundEnabled) return;
if(sounds[soundName]) sounds[soundName].play();
else playBeep(soundName);
}
function unlockAudio(){
const audioCtx = new(window.AudioContext || window.webkitAudioContext)();
if(audioCtx.state === 'suspended'){
const resume = () => { audioCtx.resume(); document.removeEventListener('click', resume); };
document.addEventListener('click', resume, {once: true});
}
}

// ------------------------------------------------------------
// OYUN DURUMU
// ------------------------------------------------------------
let gameState = {
  hintsUsed: 0,
  maxUnlockedLevel: 1,
  currentLevel: 1,
  currentQuestionIndexInLevel: 0,
  score: 0,
  earnedPointsForQuestion: {},
  hintUsedInThisLevel: false,
  achievements: {
    firstCorrect: false,
    streak: 0,
    quranMaster: false,
    namazkar: false,
    peygamberSever: false,
    level5: false,
    level10: false,
    level15: false,
    level20: false,
    level25: false,
    level30: false,
    level35: false,
    level40: false,
    level45: false,
    level50: false
  },
  recentAchievements: [],
  solvedQuestions: [],
  lastPlayedQuestions: [], // YENƒ∞: Son oynanan sorularƒ±n ID'leri
  username: '',
  avatar: AVATAR_LIST[0].icon,
  avatarImg: AVATAR_LIST[0].img,
  darkMode: false
};

function loadGameState(){
const saved = localStorage.getItem(STORAGE_KEY);
if(saved){
try{
const parsed = JSON.parse(saved);
gameState = { ...gameState, ...parsed};
if(!gameState.earnedPointsForQuestion) gameState.earnedPointsForQuestion = {};
if(!gameState.achievements){
gameState.achievements = {
firstCorrect: false, streak: 0, quranMaster: false, namazkar: false, peygamberSever: false,
level5: false, level10: false, level15: false, level20: false, level25: false,
level30: false, level35: false, level40: false, level45: false, level50: false
};
}
if(!gameState.recentAchievements) gameState.recentAchievements = [];
if(!gameState.solvedQuestions) gameState.solvedQuestions = [];
if(!gameState.lastPlayedQuestions) gameState.lastPlayedQuestions = []; // YENƒ∞
if(isNaN(gameState.score)) gameState.score = 0;
}catch(e){}
}
}
function saveGameState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(gameState)); }

// ------------------------------------------------------------
// DOM ELEMENTLERƒ∞
// ------------------------------------------------------------
const settingsModalOverlay = document.getElementById('settingsModalOverlay');
const introOverlay = document.getElementById('introOverlay');
const introAvatar = document.getElementById('introAvatar');
const introUserName = document.getElementById('introUserName');
const introLevel = document.getElementById('introLevel');
const introScore = document.getElementById('introScore');
const introAchievementsList = document.getElementById('introAchievementsList');
const introStartBtn = document.getElementById('introStartGameBtn');
const introSettingsBtn = document.getElementById('introSettingsBtn');
const introSettingsPanel = document.getElementById('introSettingsPanel');
const settingsUsername = document.getElementById('settingsUsername');
const settingsAvatarSelector = document.getElementById('settingsAvatarSelector');
const saveSettingsBtn = document.getElementById('saveSettingsBtn');
const closeSettingsBtn = document.getElementById('closeSettingsBtn');
// YENƒ∞: Intro'daki leaderboard butonu
const viewLeaderboardBtn = document.getElementById('viewLeaderboardBtn');

const gameContainer = document.getElementById('gameContainer');
const gameAvatar = document.getElementById('gameAvatar');
const gameUserName = document.getElementById('gameUserName');
const scoreDisplay = document.getElementById('scoreDisplay');
const currentLevelDisplay = document.getElementById('currentLevelDisplay');
const levelIndicators = document.getElementById('levelIndicators');
const questionEl = document.getElementById('questionText');
const optionsEl = document.getElementById('optionsContainer');
const nextBtn = document.getElementById('nextButton');
const hintBtn = document.getElementById('hintButton');
const timerEl = document.getElementById('timerSeconds');
const timerBox = document.getElementById('timer');
const gameOverModal = document.getElementById('gameOverModal');
const gameOverMessage = document.getElementById('gameOverMessage');
const restartGameBtn = document.getElementById('restartGameBtn');
const exitGameBtn = document.getElementById('exitGameBtn');

const leaderboardBtn = document.getElementById('leaderboardBtn');
const leaderboardPanel = document.getElementById('leaderboardPanel');
const leaderboardList = document.getElementById('leaderboardList');
const closeLeaderboardBtn = document.getElementById('closeLeaderboardBtn');
const achievementsBtn = document.getElementById('achievementsBtn');
const achievementsPanel = document.getElementById('achievementsPanel');
const achievementsList = document.getElementById('achievementsList');
const closeAchievementsBtn = document.getElementById('closeAchievementsBtn');

const adminPanel = document.getElementById('adminPanel');
const closeAdminBtn = document.getElementById('closeAdminBtn');
const adminQuestionsList = document.getElementById('adminQuestionsList');
const adminStats = document.getElementById('adminStats');
const formTitle = document.getElementById('formTitle');
const adminSoru = document.getElementById('adminSoru');
const adminSecenek1 = document.getElementById('adminSecenek1');
const adminSecenek2 = document.getElementById('adminSecenek2');
const adminSecenek3 = document.getElementById('adminSecenek3');
const adminSecenek4 = document.getElementById('adminSecenek4');
const adminDogru = document.getElementById('adminDogru');
const adminKategori = document.getElementById('adminKategori');
const adminZorluk = document.getElementById('adminZorluk');
const saveQuestionBtn = document.getElementById('saveQuestionBtn');
const cancelEditBtn = document.getElementById('cancelEditBtn');
const clearLeaderboardBtn = document.getElementById('clearLeaderboardBtn');
const resetAllUserDataBtn = document.getElementById('resetAllUserDataBtn');
const bulkAddQuestionsBtn = document.getElementById('bulkAddQuestionsBtn');

const soundToggleBtn = document.getElementById('soundToggleBtn');
const mascot = document.getElementById('mascot');
const speechBubble = document.getElementById('speechBubble');
const settingsBtn = document.getElementById('settingsBtn');

// ------------------------------------------------------------
// OYUN DEƒûƒ∞≈ûKENLERƒ∞
// ------------------------------------------------------------
let editingQuestionId = null;
let allQuestions = [];
let currentLevelQuestions = [];
let currentQuestion = null;
let answered = false;
let firstAttempt = true;
let gameActive = true;
let timerInterval = null;
let timeLeft = 60;
let eliminatedOptions = [];

// ------------------------------------------------------------
// √ñRNEK SORULARI Y√úKLE (seedQuestionsIfNeeded)
// ------------------------------------------------------------
async function seedQuestionsIfNeeded(){
try{
const q = query(collection(db, QUESTIONS_COLLECTION), limit(1));
const snapshot = await getDocs(q);
if(snapshot.empty){
for(const q of SAMPLE_QUESTIONS){
await addDoc(collection(db, QUESTIONS_COLLECTION), q);
}
console.log('√ñrnek sorular eklendi.');
}
}catch(e){
console.error('√ñrnek sorular eklenirken hata:', e);
}
}

// ------------------------------------------------------------
// Lƒ∞DERLƒ∞K TABLOSU ‚Äì SADECE EN Y√úKSEK PUANI KAYDET
// ------------------------------------------------------------
async function saveScoreToLeaderboard(){
if(!gameState.username || gameState.username === 'Misafir') return;
try{
const q = query(collection(db, LEADERBOARD_COLLECTION), where("username", "==", gameState.username.trim()));
const snapshot = await getDocs(q);

let maxScore = 0;
const docsToDelete = [];

snapshot.forEach(doc => {
const data = doc.data();
const score = Number(data.score);
if(score > maxScore) maxScore = score;
docsToDelete.push(doc.ref);
});

if(gameState.score > maxScore){
if(docsToDelete.length > 0){
const batch = writeBatch(db);
docsToDelete.forEach(ref => batch.delete(ref));
await batch.commit();
}
await addDoc(collection(db, LEADERBOARD_COLLECTION), {
username: gameState.username.trim(),
score: Number(gameState.score),
level: Number(gameState.currentLevel),
timestamp: new Date()
});
} else if(maxScore === 0 && gameState.score > 0){
await addDoc(collection(db, LEADERBOARD_COLLECTION), {
username: gameState.username.trim(),
score: Number(gameState.score),
level: Number(gameState.currentLevel),
timestamp: new Date()
});
}
}catch(e){
console.error("Liderlik kaydedilemedi:", e);
}
}

async function loadLeaderboard(){
try{
const q = query(collection(db, LEADERBOARD_COLLECTION), orderBy('score', 'desc'), limit(10));
const snapshot = await getDocs(q);
let html = '<ol style="list-style:none; padding:0;">';
snapshot.forEach((doc, idx) => {
const data = doc.data();
let scoreVal = Number(data.score);
if(isNaN(scoreVal)) scoreVal = 0;
const username = data.username?.trim() || 'ƒ∞simsiz';
let levelVal = Number(data.level);
if(isNaN(levelVal) || levelVal < 1) levelVal = 1;
const rank = idx + 1;
html += `<li style="display:flex;align-items:center;padding:8px 10px;background:#fef9e0;margin-bottom:6px;border-radius:30px;font-size:13px;gap:6px;">
<i class="fas fa-user-circle" style="font-size:16px;"></i>
<span style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100px;">${username}</span>
<span style="margin-left:auto;background:#ffd966;padding:3px 10px;border-radius:20px;font-size:12px;">${scoreVal} puan</span>
<span style="margin-left:auto;background:#ffd966;padding:3px 10px;border-radius:20px;font-size:12px;">${levelVal} seviye</span>

</li>`;
});
html += '</ol>';
leaderboardList.innerHTML = html;
}catch(e){
leaderboardList.innerHTML = 'Liderlik y√ºklenemedi.';
}
}

// ------------------------------------------------------------
// YARDIMCI FONKSƒ∞YONLAR
// ------------------------------------------------------------
function showToast(message, type='success'){
const container = document.getElementById('toastContainer');
const toast = document.createElement('div');
toast.className = `toast-message ${type === 'success' ? 'toast-success' : 'toast-info'}`;
toast.innerHTML = `<i class="fas ${type === 'success' ? 'fa-circle-check' : 'fa-circle-info'}"></i> ${message}`;
container.appendChild(toast);
setTimeout(() => toast.remove(), 2500);
}
function triggerConfetti(){ confetti({particleCount: 80, spread: 70, origin: {y: 0.6}}); }

function initAvatarSelector(){
settingsAvatarSelector.innerHTML = '';
AVATAR_LIST.forEach((av, idx) => {
const div = document.createElement('div');
div.className = 'avatar-option' + (av.icon === gameState.avatar ? ' selected' : '');
div.innerHTML = av.icon;
div.dataset.avatarIcon = av.icon;
div.dataset.avatarImg = av.img;
div.dataset.avatarName = av.name;
div.addEventListener('click', function(){
document.querySelectorAll('#settingsAvatarSelector .avatar-option').forEach(el => el.classList.remove('selected'));
this.classList.add('selected');
});
settingsAvatarSelector.appendChild(div);
});
}

async function updateIntroUI(){
introAvatar.innerText = gameState.avatar;
introUserName.innerText = gameState.username || 'Misafir';
introLevel.innerText = gameState.currentLevel;
introScore.innerText = gameState.score;
updateAchievementsPreview();
}

function updateAchievementsPreview(){
let html = '<ul style="list-style:none; padding:0;">';
if(gameState.recentAchievements && gameState.recentAchievements.length > 0){
gameState.recentAchievements.slice(0, 3).forEach(b => {
html += `<li style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"><i class="fas fa-medal" style="color:#ffc107;"></i> ${b}</li>`;
});
} else {
html += '<li style="color: #6b7280;">Hen√ºz ba≈üarƒ±m yok</li>';
}
html += '</ul>';
introAchievementsList.innerHTML = html;
}

// ------------------------------------------------------------
// G√úNCELLENMƒ∞≈û updateGameHeader ‚Äì sadece var olan elementleri g√ºnceller
// ------------------------------------------------------------
function updateGameHeader(){
gameAvatar.innerText = gameState.avatar;
gameUserName.innerText = gameState.username;
if(scoreDisplay) scoreDisplay.innerText = gameState.score;
if(currentLevelDisplay) currentLevelDisplay.innerText = gameState.currentLevel;
}

               function saveSettings() {
            const newName = settingsUsername.value.trim() || 'Misafir';
            const selectedAvatar = document.querySelector('#settingsAvatarSelector .avatar-option.selected');
            if (selectedAvatar) {
                gameState.avatar = selectedAvatar.dataset.avatarIcon;
                gameState.avatarImg = selectedAvatar.dataset.avatarImg;
            }
            gameState.username = newName;
            saveGameState();
            updateIntroUI();
            updateGameHeader();
            settingsModalOverlay.classList.remove('active');
            showToast('Profil g√ºncellendi!', 'success');
        }



// ------------------------------------------------------------
// D√úZELTƒ∞LMƒ∞≈û startGameFromIntro - ƒ∞LKNU KONTROL√ú EKLENDƒ∞
// ------------------------------------------------------------
function startGameFromIntro(){
if(!gameState.username){
gameState.username = 'Misafir';
gameState.avatar = AVATAR_LIST[0].icon;
saveGameState();
}
updateGameHeader();
introOverlay.classList.add('hidden');
gameContainer.style.display = 'block';
loadLevelQuestions(gameState.currentLevel);
renderLevelIndicators();
unlockAudio();

// --- D√úZELTME: ƒ∞lknur i√ßin Sweet Alert ---
// Kullanƒ±cƒ± adƒ± kontrol√º - bo≈üluklarƒ± temizle ve k√º√ß√ºk harfe √ßevir
const userNameClean = gameState.username.trim().toLowerCase();
if(userNameClean === 'ilknur'){
Swal.fire({
title: '‚ù§Ô∏è √ñzel Mesaj ‚ù§Ô∏è',
text: 'Ercan seni seviyor!',
icon: 'success',
confirmButtonText: 'Ben de seni seviyorum',
confirmButtonColor: '#ff6b6b',
background: '#fff5f5',
timer: 5000,
timerProgressBar: true
});
}
// --------------------------------------
}

function exitToIntro(){
gameContainer.style.display = 'none';
introOverlay.classList.remove('hidden');
clearInterval(timerInterval);
updateIntroUI();
}

// ------------------------------------------------------------
// OYUN FONKSƒ∞YONLARI (kƒ±saltƒ±ldƒ±, asƒ±l kodda uzun)
// ------------------------------------------------------------
async function loadAllQuestions(){
try{
const q = query(collection(db, QUESTIONS_COLLECTION));
const snapshot = await getDocs(q);
allQuestions = [];
snapshot.forEach(doc => allQuestions.push({id: doc.id, ...doc.data()}));
if(allQuestions.length === 0) allQuestions = SAMPLE_QUESTIONS.map((q, idx) => ({id: `sample-${idx}`, ...q}));
}catch(e){
allQuestions = SAMPLE_QUESTIONS.map((q, idx) => ({id: `sample-${idx}`, ...q}));
}
}
            
// Bilgi balonunu g√∂steren fonksiyon
function showInfoBubble(message, targetElement) {
  const modal = document.getElementById('infoBubble');
  if (!modal) return;

  modal.innerHTML = message;
  modal.classList.add('active');

  clearTimeout(modal._timer);
  modal._timer = setTimeout(() => {
    modal.classList.remove('active');
  }, 2000);
}
            

// levelProgress elementine tƒ±klama olayƒ± ekle
document.getElementById('levelProgress')?.addEventListener('click', function(e) {
    const total = getQuestionCountForLevel(gameState.currentLevel);
    const answered = gameState.currentQuestionIndexInLevel;
    const remaining = total - answered;
    const message = `Toplam soru: ${total} <br> Cevaplanan: ${answered} <br> Kalan: ${remaining}`;
    showInfoBubble(message, this);
});

            
//function getQuestionCountForLevel(level) {return level * 2 + 5;}   STAR (BUNU KULLAN)
function getQuestionCountForLevel(level){ return level * 2; }

            // Seviye ilerleme bilgisini g√ºncelle
function updateLevelProgress() {
  const total = getQuestionCountForLevel(gameState.currentLevel);
  const answered = gameState.currentQuestionIndexInLevel; // cevaplanan soru sayƒ±sƒ±
  const remaining = total - answered;
  const progressDiv = document.getElementById('levelProgress');
  if (progressDiv) {
    progressDiv.innerHTML = `üìä`;
  }
}
            

function loadLevelQuestions(level) {
  const countNeeded = getQuestionCountForLevel(level);

  // √ñnce √ß√∂z√ºlmemi≈ü sorularƒ± filtrele
  let unsolved = allQuestions.filter(q => !gameState.solvedQuestions.includes(q.id));

  // Son oynanan sorularƒ± da filtrele (t√ºm seviyelerden)
  let availableQuestions = unsolved.filter(q => !gameState.lastPlayedQuestions.includes(q.id));

  // Eƒüer yeterli soru kalmadƒ±ysa, son oynananlarƒ± sƒ±fƒ±rla
  if (availableQuestions.length < countNeeded) {
    // Son oynananlardan en eskilerini kaldƒ±r
    const removeCount = Math.max(5, countNeeded - availableQuestions.length);
    gameState.lastPlayedQuestions = gameState.lastPlayedQuestions.slice(removeCount);

    // Tekrar filtrele
    availableQuestions = unsolved.filter(q => !gameState.lastPlayedQuestions.includes(q.id));

    // H√¢l√¢ yetersizse √ß√∂z√ºlm√º≈ü sorulardan da se√ß (ama son oynananlar hari√ß)
    if (availableQuestions.length < countNeeded) {
      const solvedButNotRecent = allQuestions.filter(q =>
        gameState.solvedQuestions.includes(q.id) &&
        !gameState.lastPlayedQuestions.includes(q.id)
      );
      availableQuestions = [...availableQuestions, ...solvedButNotRecent];
    }
  }

  // Eƒüer h√¢l√¢ yetersizse (√ßok az soru varsa), son oynananlarƒ± tamamen sƒ±fƒ±rla
  if (availableQuestions.length < countNeeded) {
    gameState.lastPlayedQuestions = [];
    availableQuestions = unsolved.length > 0 ? unsolved : allQuestions;
  }

  const shuffled = [...availableQuestions].sort(() => Math.random() - 0.5);
  currentLevelQuestions = shuffled.slice(0, countNeeded);

  // Se√ßilen sorularƒ± son oynananlara ekle
  currentLevelQuestions.forEach(q => {
    if (!gameState.lastPlayedQuestions.includes(q.id)) {
      gameState.lastPlayedQuestions.push(q.id);
    }
  });

  // En fazla son 50 soruyu tut (performans i√ßin)
  if (gameState.lastPlayedQuestions.length > 50) {
    gameState.lastPlayedQuestions = gameState.lastPlayedQuestions.slice(-50);
  }
gameState.currentQuestionIndexInLevel = 0;
gameState.hintUsedInThisLevel = false;
gameState.hintsUsed = 0;        // <-- YENƒ∞: ipucu sayacƒ±nƒ± sƒ±fƒ±rla
hintBtn.classList.remove('disabled');
loadQuestionAtIndex(0);

  // YENƒ∞: Seviye ilerleme bilgisini g√ºncelle
  updateLevelProgress();

  // YENƒ∞: Son oynananlarƒ± kaydet
  saveGameState();
 updateHintButton();// ƒ∞pucu butonunda kalan hakkƒ± g√∂stermek isterseniz (opsiyonel)
}



    function updateHintButton() {
  const maxHints = gameState.currentLevel;
  const used = gameState.hintsUsed || 0;
  hintBtn.innerHTML = `<i class="fas fa-lightbulb"></i> ƒ∞pucu (5 puan)<br> Kalan: ${maxHints - used}`;
}        

function loadQuestionAtIndex(index) {
  if (!currentLevelQuestions.length) return;
  currentQuestion = currentLevelQuestions[index];
  questionEl.innerText = currentQuestion.soru;
  optionsEl.innerHTML = '';
  currentQuestion.secenekler.forEach((sec, idx) => {
    const btn = document.createElement('button');
    btn.className = 'option-btn';
    btn.innerHTML = `<span style="font-weight:700; margin-right:8px;">${String.fromCharCode(65 + idx)}</span> ${sec}`;
    btn.dataset.optionIndex = idx;
    btn.addEventListener('click', () => handleOptionClick(idx, btn));
    optionsEl.appendChild(btn);
  });
  answered = false;
  firstAttempt = true;
  eliminatedOptions = [];
  nextBtn.classList.add('disabled');
  nextBtn.classList.remove('active');
  startTimer(60);
  
  // YENƒ∞: Seviye ilerleme bilgisini g√ºncelle
  updateLevelProgress();
}

function startTimer(seconds){
if(timerInterval) clearInterval(timerInterval);
timeLeft = seconds;
timerEl.innerText = timeLeft;
timerBox.style.display = 'flex';
timerInterval = setInterval(() => {
timeLeft--;
timerEl.innerText = timeLeft;
if(timeLeft <= 0){
clearInterval(timerInterval);
if(!answered){
if(firstAttempt){
playSound('wrong');
showToast('‚è≥ S√ºre doldu! Bir hakkƒ±n kaldƒ±.', 'info');
firstAttempt = false;
} else {
gameActive = false;
gameOverMessage.innerText = 'S√ºre doldu ve ikinci hakkƒ±nƒ± kullanamadƒ±n.';
gameOverModal.classList.add('active');
document.querySelectorAll('.option-btn').forEach(b => b.classList.add('disabled'));
playSound('gameOver');
}
}
}
}, 1000);
}


            

//Her seviyede seviye numarasƒ± kadar ipucu hakkƒ± olsun, maliyet sabit 5 puan. Ancak bunu minimum deƒüi≈üiklikle yapmak istiyorsunuz
async function useHint() {
  const maxHints = gameState.currentLevel; // seviye kadar hak
  if (gameState.hintsUsed >= maxHints) {
    showToast(`Bu seviyede en fazla ${maxHints} ipucu kullanabilirsin!`, 'info');
    return;
  }
  if (gameState.score < 5) {
    showToast('ƒ∞pucu i√ßin 5 puana ihtiyacƒ±n var!', 'info');
    return;
  }
  if (answered) {
    showToast('Soruyu cevapladƒ±n, ipucu kullanamazsƒ±n!', 'info');
    return;
  }

  const correctIndex = currentQuestion.dogru;
  const allIndexes = [0, 1, 2, 3];
  const wrongIndexes = allIndexes.filter(i => i !== correctIndex);
  const shuffledWrong = wrongIndexes.sort(() => Math.random() - 0.5);
  const eliminateThese = shuffledWrong.slice(0, 2);
  
  eliminateThese.forEach(idx => {
    const btn = optionsEl.children[idx];
    if (btn) {
      btn.classList.add('eliminated');
      btn.disabled = true;
    }
  });
  
  eliminatedOptions = eliminateThese;
  gameState.score -= 5;
  if (gameState.score < 0) gameState.score = 0;
  gameState.hintsUsed++;
  
  // Eƒüer hak bittiyse butonu pasif yap
  if (gameState.hintsUsed >= maxHints) {
    hintBtn.classList.add('disabled');
  }
  
  saveGameState();
  if (scoreDisplay) scoreDisplay.innerText = gameState.score;
  playSound('hint');
  showToast(`üí° ƒ∞pucu kullanƒ±ldƒ±! Kalan hakkƒ±n: ${maxHints - gameState.hintsUsed}`, 'info');
 updateHintButton(); // eƒüer bu fonksiyon tanƒ±mlƒ±ysa
}


            




            

async function handleOptionClick(selectedIdx, btnElement){
if(!gameActive || answered) return;
if(eliminatedOptions.includes(selectedIdx)) return;

const isCorrect = (selectedIdx === currentQuestion.dogru);
const questionId = currentQuestion.id;

if(isCorrect){
clearInterval(timerInterval);
answered = true;
btnElement.classList.add('correct');
document.querySelectorAll('.option-btn').forEach(b => b.classList.add('disabled'));

if(!gameState.solvedQuestions.includes(questionId)){
gameState.solvedQuestions.push(questionId);
}

if(firstAttempt && !gameState.earnedPointsForQuestion[questionId]){
gameState.score += 1;
gameState.earnedPointsForQuestion[questionId] = true;
saveGameState();
triggerConfetti();
playSound('correct');
checkAchievements('correct', questionId);
} else if(!firstAttempt){
showToast('‚úÖ Doƒüru! (ƒ∞kinci denemede)', 'info');
playSound('correct');
} else {
showToast('‚úÖ Doƒüru!', 'success');
playSound('correct');
}

nextBtn.classList.remove('disabled');
nextBtn.classList.add('active');
if(scoreDisplay) scoreDisplay.innerText = gameState.score;
} else {
playSound('wrong');
btnElement.classList.add('wrong');
btnElement.classList.add('disabled');
btnElement.disabled = true;

if(firstAttempt){
firstAttempt = false;
showToast('‚ùå Yanlƒ±≈ü! Bir hakkƒ±n daha var.', 'info');
} else {
clearInterval(timerInterval);
gameActive = false;
gameOverMessage.innerText = `ƒ∞kinci hakkƒ±nda da yanlƒ±≈ü cevap verdin. Seviye ${gameState.currentLevel}'e geri d√∂n√ºyorsun.`;
gameOverModal.classList.add('active');
document.querySelectorAll('.option-btn').forEach(b => b.classList.add('disabled'));
playSound('gameOver');
}
}
}

function onNext(){
if(!nextBtn.classList.contains('active')) return;
gameState.currentQuestionIndexInLevel++;
updateLevelProgress();
if(gameState.currentQuestionIndexInLevel >= currentLevelQuestions.length){
const completedLevel = gameState.currentLevel;
if(completedLevel === gameState.maxUnlockedLevel) gameState.maxUnlockedLevel++;
gameState.currentLevel = completedLevel + 1;
gameState.currentQuestionIndexInLevel = 0;
gameState.hintUsedInThisLevel = false;

if(completedLevel % 5 === 0){
const levelKey = `level${completedLevel}`;
if(gameState.achievements[levelKey] === false){
unlockAchievement(levelKey);
}
}

saveGameState();
loadLevelQuestions(gameState.currentLevel);
if(currentLevelDisplay) currentLevelDisplay.innerText = gameState.currentLevel;
renderLevelIndicators();

let badgeMessage = '';
if(completedLevel % 5 === 0 && gameState.achievements[`level${completedLevel}`]){
const badgeName = ACHIEVEMENT_NAMES[`level${completedLevel}`];
badgeMessage = ` ve ${badgeName} rozeti kazandƒ±nƒ±z!`;
}



    // --- SEVƒ∞YE ATLAMA KUTLAMASI ---
    triggerConfetti();               // ‚ú® YENƒ∞: konfeti patlat
    showToast(`üéâ Tebrikler! Seviye ${completedLevel} tamamlandƒ±! Seviye ${gameState.currentLevel} ge√ßtiniz. Kendinizle gurur duymalƒ±sƒ±nƒ±z! üèÜ`, 'success');
    playSound('levelUp');
    showShareButtons(completedLevel);
  } else {
    loadQuestionAtIndex(gameState.currentQuestionIndexInLevel);
    saveGameState();
  }
  nextBtn.classList.remove('active');
  nextBtn.classList.add('disabled');
}

function restartLevelAfterGameOver(){
gameState.currentQuestionIndexInLevel = 0;
gameState.hintUsedInThisLevel = false;
gameActive = true;
gameOverModal.classList.remove('active');
loadLevelQuestions(gameState.currentLevel);
updateLevelProgress();
if(currentLevelDisplay) currentLevelDisplay.innerText = gameState.currentLevel;
}

function renderLevelIndicators(){
const maxLevel = gameState.maxUnlockedLevel;
let html = '';
for(let i = 1; i <= maxLevel + 2; i++){
if(i <= maxLevel) html += `<div class="level-badge active" data-level="${i}">${i}</div>`;
else if(i === maxLevel + 1) html += `<div class="level-badge locked" data-level="${i}"><i class="fas fa-lock"></i></div>`;
else html += `<div class="level-badge locked" style="opacity:0.4;"><i class="fas fa-lock"></i></div>`;
}
levelIndicators.innerHTML = html;
document.querySelectorAll('.level-badge.active').forEach(badge => {
badge.addEventListener('click', () => {
const lvl = parseInt(badge.dataset.level);
if(lvl <= gameState.maxUnlockedLevel && lvl !== gameState.currentLevel){
gameState.currentLevel = lvl;
gameState.currentQuestionIndexInLevel = 0;
gameState.hintUsedInThisLevel = false;
saveGameState();
loadLevelQuestions(lvl);
if(currentLevelDisplay) currentLevelDisplay.innerText = lvl;
}
});
});
}

function checkAchievements(action, questionId){
if(!gameState.achievements.firstCorrect && action === 'correct'){
unlockAchievement('firstCorrect');
}
if(action === 'correct'){
gameState.achievements.streak = (gameState.achievements.streak || 0) + 1;
if(gameState.achievements.streak === 10 && !gameState.achievements.streak){
unlockAchievement('streak');
}
} else {
gameState.achievements.streak = 0;
}
saveGameState();
}

const ACHIEVEMENT_NAMES = {
firstCorrect: 'üå± Yeni Fidan',
streak: 'üåø Yaprak',
quranMaster: 'üçÉ Dal',
namazkar: 'üå≥ Gen√ß Aƒüa√ß',
peygamberSever: 'üìö Bilge Yaprak',
level5: 'üå± Acemi Bilge',
level10: 'üåø Bilgelik Yolcusu',
level15: 'üçÉ ƒ∞lim √áƒ±raƒüƒ±',
level20: 'üå≥ Manevi Fidan',
level25: 'üìö Hakikat Arayƒ±cƒ±sƒ±',
level30: 'üïäÔ∏è Hikmet Taliplisi',
level35: '‚ú® ƒ∞rfan Dostu',
level40: 'üïå Hakikat Yolcusu',
level45: 'üåü Marifet Sahibi',
level50: 'üëë Manevi Alim'
};

function unlockAchievement(achievementKey){
if(!gameState.achievements[achievementKey]){
gameState.achievements[achievementKey] = true;
const achievementName = ACHIEVEMENT_NAMES[achievementKey];
gameState.recentAchievements.unshift(achievementName);
if(gameState.recentAchievements.length > 3) gameState.recentAchievements.pop();
saveGameState();
showToast(`üèÜ Ba≈üarƒ±m kazandƒ±nƒ±z: ${achievementName}`, 'success');
triggerConfetti();
}
}

function renderAchievements(){
const a = gameState.achievements;
let html = '<ul style="list-style:none; padding:0;">';

html += `<li style="padding:12px; background:${a.firstCorrect ? '#d4edda' : '#f8f9fa'}; margin-bottom:8px; border-radius:40px;">
<i class="fas fa-star" style="color:${a.firstCorrect ? '#ffc107' : '#6c757d'};"></i> üå± Yeni Fidan ${a.firstCorrect ? '‚úì' : '‚ùå'}</li>`;
html += `<li style="padding:12px; background:${(a.streak || 0) >= 10 ? '#d4edda' : '#f8f9fa'}; margin-bottom:8px; border-radius:40px;">
<i class="fas fa-fire" style="color:${(a.streak || 0) >= 10 ? '#ff9800' : '#6c757d'};"></i> üåø Yaprak ${(a.streak || 0) >= 10 ? '‚úì' : '‚ùå'}</li>`;
html += `<li style="padding:12px; background:${a.quranMaster ? '#d4edda' : '#f8f9fa'}; margin-bottom:8px; border-radius:40px;">
<i class="fas fa-book" style="color:${a.quranMaster ? '#28a745' : '#6c757d'};"></i> üçÉ Dal ${a.quranMaster ? '‚úì' : '‚ùå'}</li>`;
html += `<li style="padding:12px; background:${a.namazkar ? '#d4edda' : '#f8f9fa'}; margin-bottom:8px; border-radius:40px;">
<i class="fas fa-mosque" style="color:${a.namazkar ? '#28a745' : '#6c757d'};"></i> üå≥ Gen√ß Aƒüa√ß ${a.namazkar ? '‚úì' : '‚ùå'}</li>`;
html += `<li style="padding:12px; background:${a.peygamberSever ? '#d4edda' : '#f8f9fa'}; margin-bottom:8px; border-radius:40px;">
<i class="fas fa-dove" style="color:${a.peygamberSever ? '#28a745' : '#6c757d'};"></i> üìö Bilge Yaprak ${a.peygamberSever ? '‚úì' : '‚ùå'}</li>`;

const levelAchievements = [
{key: 'level5', name: 'üå± Acemi Bilge'},
{key: 'level10', name: 'üåø Bilgelik Yolcusu'},
{key: 'level15', name: 'üçÉ ƒ∞lim √áƒ±raƒüƒ±'},
{key: 'level20', name: 'üå≥ Manevi Fidan'},
{key: 'level25', name: 'üìö Hakikat Arayƒ±cƒ±sƒ±'},
{key: 'level30', name: 'üïäÔ∏è Hikmet Taliplisi'},
{key: 'level35', name: '‚ú® ƒ∞rfan Dostu'},
{key: 'level40', name: 'üïå Hakikat Yolcusu'},
{key: 'level45', name: 'üåü Marifet Sahibi'},
{key: 'level50', name: 'üëë Manevi Alim'}
];

levelAchievements.forEach(ach => {
html += `<li style="padding:12px; background:${a[ach.key] ? '#d4edda' : '#f8f9fa'}; margin-bottom:8px; border-radius:40px;">
<i class="fas fa-crown" style="color:${a[ach.key] ? '#ffc107' : '#6c757d'};"></i> ${ach.name} ${a[ach.key] ? '‚úì' : '‚ùå'}</li>`;
});

html += '</ul>';
achievementsList.innerHTML = html;
}

// ------------------------------------------------------------
// SOSYAL MEDYA PAYLA≈ûIMI
// ------------------------------------------------------------
function showShareButtons(level){
const text = `Manevi Bilgi Oyunu'nda Seviye ${level} tamamladƒ±m! Yarƒ±≈ümayƒ± sen de dene üåô tr.ee/esahin`;
const shareDiv = document.createElement('div');
shareDiv.style = 'position:fixed; bottom:100px; right:20px; background:white; border-radius:40px; padding:15px; box-shadow:0 10px 0 #ffe0b5; z-index:10002; border:2px solid #ffe0b0;';
shareDiv.innerHTML = `
<p style="margin-bottom:10px;"><i class="fas fa-share-alt"></i> Payla≈ü:</p>
<a href="https://wa.me/?text=${encodeURIComponent(text)}" target="_blank" style="margin-right:15px;"><i class="fab fa-whatsapp" style="color:#25D366; font-size:1.8rem;"></i></a>
<a href="https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}" target="_blank" style="margin-right:15px;"><i class="fab fa-twitter" style="color:#1DA1F2; font-size:1.8rem;"></i></a>
<a href="https://t.me/share/url?url=tr.ee/esahin&text=${encodeURIComponent(text)}" target="_blank"><i class="fab fa-telegram" style="color:#0088cc; font-size:1.8rem;"></i></a>
<button id="closeShare" style="margin-left:15px; background:none; border:none;"><i class="fas fa-times"></i></button>
`;
document.body.appendChild(shareDiv);
document.getElementById('closeShare')?.addEventListener('click', () => shareDiv.remove());
setTimeout(() => shareDiv.remove(), 10000);
}

// ------------------------------------------------------------
// ADMIN PANELƒ∞ FONKSƒ∞YONLARI (kƒ±saltƒ±ldƒ±)
// ------------------------------------------------------------
async function clearLeaderboard(){
if(!confirm('‚ö†Ô∏è T√ºm liderlik kayƒ±tlarƒ±nƒ± silmek istediƒüinize emin misiniz? Bu i≈ülem geri alƒ±namaz!')) return;
try{
const q = query(collection(db, LEADERBOARD_COLLECTION));
const snapshot = await getDocs(q);
const batch = writeBatch(db);
snapshot.docs.forEach(doc => batch.delete(doc.ref));
await batch.commit();
showToast('Liderlik tablosu tamamen temizlendi!', 'success');
await loadLeaderboard();
} catch(e){
showToast('Temizleme ba≈üarƒ±sƒ±z: ' + e.message, 'error');
}
}

async function resetAllUserData(){
if(!confirm('‚ö†Ô∏è T√úM KULLANICI VERƒ∞LERƒ∞Nƒ∞ SIFIRLA? Bu i≈ülem:\n- LocalStorage\'daki oyun ilerlemenizi siler\n- Firestore\'daki t√ºm liderlik kayƒ±tlarƒ±nƒ± siler\n- Oyun ba≈ülangƒ±√ß seviyesine d√∂ner\n\nDevam etmek istediƒüinize emin misiniz?')) return;
try{
localStorage.removeItem(STORAGE_KEY);
const q = query(collection(db, LEADERBOARD_COLLECTION));
const snapshot = await getDocs(q);
const batch = writeBatch(db);
snapshot.docs.forEach(doc => batch.delete(doc.ref));
await batch.commit();

gameState = {
maxUnlockedLevel: 1,
currentLevel: 1,
currentQuestionIndexInLevel: 0,
score: 0,
earnedPointsForQuestion: {},
hintUsedInThisLevel: false,
achievements: {
firstCorrect: false, streak: 0, quranMaster: false, namazkar: false, peygamberSever: false,
level5: false, level10: false, level15: false, level20: false, level25: false,
level30: false, level35: false, level40: false, level45: false, level50: false
},
recentAchievements: [],
solvedQuestions: [],
username: '',
avatar: AVATAR_LIST[0].icon,
avatarImg: AVATAR_LIST[0].img,
darkMode: false
};
saveGameState();

await updateIntroUI();
await loadLeaderboard();
showToast('T√ºm kullanƒ±cƒ± verileri sƒ±fƒ±rlandƒ±!', 'success');
adminPanel.classList.remove('active');
introOverlay.classList.remove('hidden');
gameContainer.style.display = 'none';
} catch(e){
showToast('Sƒ±fƒ±rlama ba≈üarƒ±sƒ±z: ' + e.message, 'error');
}
}

// Toplu soru ekleme
let lastAddedCount = 0;
let lastSkippedCount = 0;
let lastBulkTime = '';

async function bulkAddQuestions(){
// SweetAlert ile y√ºkleme uyarƒ±sƒ± g√∂ster
Swal.fire({
title: 'Y√ºkleniyor, l√ºtfen bekleyiniz...',
text: 'Sorular Firestore\'a ekleniyor',
allowOutsideClick: false,
allowEscapeKey: false,
allowEnterKey: false,
showConfirmButton: false,
willOpen: () => {
Swal.showLoading();
}
});

try{
const existingQuestionsSnapshot = await getDocs(collection(db, QUESTIONS_COLLECTION));
const existingQuestionsSet = new Set();
existingQuestionsSnapshot.forEach(doc => {
const data = doc.data();
if(data.soru) existingQuestionsSet.add(data.soru);
});

let addedCount = 0;
let skippedCount = 0;

for(const q of SAMPLE_QUESTIONS){
if(!existingQuestionsSet.has(q.soru)){
await addDoc(collection(db, QUESTIONS_COLLECTION), q);
addedCount++;
} else {
skippedCount++;
}
}

lastAddedCount = addedCount;
lastSkippedCount = skippedCount;
lastBulkTime = new Date().toLocaleString('tr-TR');

// Ba≈üarƒ±lƒ± sonu√ß
Swal.fire({
icon: 'success',
title: 'ƒ∞≈ülem Tamamlandƒ±!',
text: `${addedCount} yeni soru eklendi, ${skippedCount} soru zaten mevcuttu.`,
confirmButtonColor: '#7c3aed',
background: '#fff9e6'
});

await loadAllQuestions();
await loadAdminQuestions();
await updateAdminStats();

} catch(e){
// Hata durumu
Swal.fire({
icon: 'error',
title: 'Hata!',
text: 'Toplu ekleme ba≈üarƒ±sƒ±z: ' + e.message,
confirmButtonColor: '#7c3aed',
background: '#fff9e6'
});
}
}

// Admin istatistiklerini g√ºncelle
async function updateAdminStats(){
const totalQuestions = allQuestions.length;
adminStats.innerHTML = `
<p><span>üìö Toplam Soru:</span> <strong>${totalQuestions}</strong></p>
<p><span>‚ûï Son Eklenen:</span> <strong>${lastAddedCount || 0}</strong></p>
<p><span>‚è≠Ô∏è Atlanan (Tekrar):</span> <strong>${lastSkippedCount || 0}</strong></p>
<p><span>üïí Son ƒ∞≈ülem:</span> <strong>${lastBulkTime || 'Hen√ºz yapƒ±lmadƒ±'}</strong></p>
`;
}

async function loadAdminQuestions(){
try{
const q = query(collection(db, QUESTIONS_COLLECTION), orderBy('zorluk', 'asc'));
const snapshot = await getDocs(q);
let html = '';
snapshot.forEach(doc => {
const data = doc.data();
const soruKisa = data.soru.length > 50 ? data.soru.substring(0, 50) + '‚Ä¶' : data.soru;
html += `
<div class="admin-question-item" data-id="${doc.id}">
<div class="admin-question-header">
<span class="admin-question-text">${soruKisa}</span>
<div class="admin-question-actions">
<button class="edit-question-btn" title="D√ºzenle"><i class="fas fa-edit" style="color:#7c3aed;"></i></button>
<button class="delete-question-btn" title="Sil"><i class="fas fa-trash" style="color:#e53e3e;"></i></button>
</div>
</div>
<div class="admin-question-meta">
<span><i class="fas fa-tag"></i> ${data.bolum || 'Genel'}</span>
<span><i class="fas fa-signal"></i> Zorluk: ${data.zorluk || 1}</span>
</div>
</div>
`;
});
adminQuestionsList.innerHTML = html || '<p style="color: #6b7280; text-align: center;">Hen√ºz soru yok.</p>';

document.querySelectorAll('.edit-question-btn').forEach(btn => {
btn.addEventListener('click', (e) => {
const questionItem = e.target.closest('.admin-question-item');
const questionId = questionItem.dataset.id;
editQuestion(questionId);
});
});

document.querySelectorAll('.delete-question-btn').forEach(btn => {
btn.addEventListener('click', async (e) => {
const questionItem = e.target.closest('.admin-question-item');
const questionId = questionItem.dataset.id;
if(confirm('Bu soruyu silmek istediƒüinize emin misiniz?')){
await deleteQuestion(questionId);
}
});
});
} catch(e){
adminQuestionsList.innerHTML = '<p style="color: red;">Sorular y√ºklenemedi.</p>';
}
}

async function editQuestion(questionId){
try{
const docRef = doc(db, QUESTIONS_COLLECTION, questionId);
const docSnap = await getDoc(docRef);
if(docSnap.exists()){
const data = docSnap.data();
adminSoru.value = data.soru || '';
adminSecenek1.value = data.secenekler?.[0] || '';
adminSecenek2.value = data.secenekler?.[1] || '';
adminSecenek3.value = data.secenekler?.[2] || '';
adminSecenek4.value = data.secenekler?.[3] || '';
adminDogru.value = data.dogru || 0;
adminKategori.value = data.bolum || 'Kur\'an';
adminZorluk.value = data.zorluk || 1;
editingQuestionId = questionId;
formTitle.innerHTML = '<i class="fas fa-edit"></i> Soruyu D√ºzenle';
saveQuestionBtn.innerHTML = '<i class="fas fa-save"></i> Soruyu G√ºncelle';
cancelEditBtn.style.display = 'block';
}
} catch(e){
showToast('Soru y√ºklenirken hata olu≈ütu.', 'error');
}
}

async function deleteQuestion(questionId){
try{
await deleteDoc(doc(db, QUESTIONS_COLLECTION, questionId));
showToast('Soru silindi!', 'success');
await loadAdminQuestions();
await loadAllQuestions();
await updateAdminStats();
if(editingQuestionId === questionId) resetFormToAddMode();
} catch(e){
showToast('Soru silinemedi.', 'error');
}
}

function resetFormToAddMode(){
adminSoru.value = '';
adminSecenek1.value = '';
adminSecenek2.value = '';
adminSecenek3.value = '';
adminSecenek4.value = '';
adminDogru.value = 0;
adminKategori.value = 'Kur\'an';
adminZorluk.value = 1;
editingQuestionId = null;
formTitle.innerHTML = '<i class="fas fa-plus-circle"></i> Yeni Soru Ekle';
saveQuestionBtn.innerHTML = '<i class="fas fa-save"></i> Soruyu Kaydet';
cancelEditBtn.style.display = 'none';
}

async function saveQuestion(){
const soru = adminSoru.value.trim();
const sec1 = adminSecenek1.value.trim();
const sec2 = adminSecenek2.value.trim();
const sec3 = adminSecenek3.value.trim();
const sec4 = adminSecenek4.value.trim();
const dogru = parseInt(adminDogru.value);
const kategori = adminKategori.value;
const zorluk = parseInt(adminZorluk.value);
if(!soru || !sec1 || !sec2 || !sec3 || !sec4){
showToast('L√ºtfen t√ºm alanlarƒ± doldurun.', 'error');
return;
}
const questionData = {bolum: kategori, soru, secenekler: [sec1, sec2, sec3, sec4], dogru, zorluk };
try{
if(editingQuestionId){
await updateDoc(doc(db, QUESTIONS_COLLECTION, editingQuestionId), questionData);
showToast('Soru g√ºncellendi!', 'success');
} else {
await addDoc(collection(db, QUESTIONS_COLLECTION), questionData);
showToast('Soru eklendi!', 'success');
}
resetFormToAddMode();
await loadAdminQuestions();
await loadAllQuestions();
await updateAdminStats();
} catch(e){
showToast('ƒ∞≈ülem ba≈üarƒ±sƒ±z.', 'error');
}
}

// YENƒ∞: Admin trigger - 5 kere tƒ±klama ile giri≈ü
let adminClickCount = 0;
let adminClickTimer = null;

function initAdminTrigger(){
if(!gameAvatar) return;

gameAvatar.addEventListener('click', async () => {
adminClickCount++;
    
    // ƒ∞lk tƒ±klamada timer ba≈ülat
    if(adminClickCount === 1){
        adminClickTimer = setTimeout(() => {
            adminClickCount = 0;
        }, 3000);
    }
    
    // 5 kere tƒ±klandƒ±ƒüƒ±nda
    if(adminClickCount === 5){
        clearTimeout(adminClickTimer);
        adminClickCount = 0;
        
        // SweetAlert ile ≈üifre sorma
        const {value: password} = await Swal.fire({
            title: 'Admin Giri≈üi',
            text: 'admin123:',
            input: 'password',
            inputPlaceholder: '≈ûifre',
            showCancelButton: true,
            confirmButtonText: 'Giri≈ü Yap',
            cancelButtonText: 'ƒ∞ptal',
            confirmButtonColor: '#7c3aed',
            background: '#fff9e6',
            backdrop: true,
            allowOutsideClick: false,
            customClass: {
                popup: 'rounded-3xl shadow-2xl border-4 border-[#ffe8d9]'
            }
        });

        if(password === ADMIN_PASSWORD){
            // ≈ûifre doƒüruysa admin panelini a√ß
            adminPanel.classList.add('active');
            await loadAdminQuestions();
            await updateAdminStats();
            resetFormToAddMode();

            Swal.fire({
                icon: 'success',
                title: 'Giri≈ü Ba≈üarƒ±lƒ±',
                text: 'Ho≈ü geldiniz!',
                timer: 1500,
                showConfirmButton: false,
                background: '#fff9e6'
            });
        } else if(password !== undefined){
            // ≈ûifre yanlƒ±≈üsa uyarƒ±
            Swal.fire({
                icon: 'error',
                title: 'Hatalƒ± ≈ûifre',
                text: 'L√ºtfen tekrar deneyin.',
                confirmButtonColor: '#7c3aed',
                background: '#fff9e6'
            });
        }
        // Kullanƒ±cƒ± iptal ederse hi√ßbir ≈üey yapma
    }
});
}

// ------------------------------------------------------------
// MASKOT, SES, DARK MODE
// ------------------------------------------------------------
function mascotSpeak(text){
speechBubble.innerText = text;
speechBubble.classList.add('active');
setTimeout(() => speechBubble.classList.remove('active'), 3000);
}

function toggleSound(){
soundEnabled = !soundEnabled;
const icon = soundToggleBtn.querySelector('i');
if(soundEnabled){
icon.classList.remove('fa-volume-mute');
icon.classList.add('fa-volume-up');
} else {
icon.classList.remove('fa-volume-up');
icon.classList.add('fa-volume-mute');
}
}

function toggleDarkMode(){
document.body.classList.toggle('dark-theme');
gameState.darkMode = document.body.classList.contains('dark-theme');
const icon = settingsBtn.querySelector('i');
if(gameState.darkMode){
icon.classList.remove('fa-moon');
icon.classList.add('fa-sun');
} else {
icon.classList.remove('fa-sun');
icon.classList.add('fa-moon');
}
saveGameState();
}

// ------------------------------------------------------------
// EVENT Lƒ∞STENERLAR
// ------------------------------------------------------------
window.addEventListener('DOMContentLoaded', async () => {
loadGameState();
await seedQuestionsIfNeeded();
await loadAllQuestions();

initAvatarSelector();
settingsUsername.value = gameState.username || 'Misafir';

if(gameState.darkMode){
document.body.classList.add('dark-theme');
settingsBtn.querySelector('i').classList.remove('fa-moon');
settingsBtn.querySelector('i').classList.add('fa-sun');
} else {
settingsBtn.querySelector('i').classList.add('fa-moon');
}

await updateIntroUI();

  introStartBtn.addEventListener('click', startGameFromIntro);         
  introSettingsBtn.addEventListener('click', () => {
  settingsUsername.value = gameState.username;
  document.querySelectorAll('#settingsAvatarSelector .avatar-option').forEach(el => {
  if (el.dataset.avatarIcon === gameState.avatar) el.classList.add('selected');
  else el.classList.remove('selected');
   });
   settingsModalOverlay.classList.add('active');
   });
 saveSettingsBtn.addEventListener('click', saveSettings);
 closeSettingsBtn.addEventListener('click', () => settingsModalOverlay.classList.remove('active'));
settingsModalOverlay.addEventListener('click', (e) => {
 if (e.target === settingsModalOverlay) settingsModalOverlay.classList.remove('active');
});

            



            
// YENƒ∞: Intro'daki "En ƒ∞yisini G√∂r" butonu
if(viewLeaderboardBtn){
viewLeaderboardBtn.addEventListener('click', async () => {
await saveScoreToLeaderboard();
await loadLeaderboard();
leaderboardPanel.classList.add('active');
});
}

nextBtn.addEventListener('click', onNext);
hintBtn.addEventListener('click', useHint);
restartGameBtn.addEventListener('click', restartLevelAfterGameOver);
exitGameBtn.addEventListener('click', exitToIntro);

leaderboardBtn.addEventListener('click', async () => {
await saveScoreToLeaderboard();
await loadLeaderboard();
leaderboardPanel.classList.add('active');
});
closeLeaderboardBtn.addEventListener('click', () => leaderboardPanel.classList.remove('active'));

achievementsBtn.addEventListener('click', () => { renderAchievements(); achievementsPanel.classList.add('active'); });
closeAchievementsBtn.addEventListener('click', () => achievementsPanel.classList.remove('active'));

closeAdminBtn.addEventListener('click', () => {
adminPanel.classList.remove('active');
resetFormToAddMode();
});
saveQuestionBtn.addEventListener('click', saveQuestion);
cancelEditBtn.addEventListener('click', resetFormToAddMode);

if(clearLeaderboardBtn){
clearLeaderboardBtn.addEventListener('click', clearLeaderboard);
}

if(resetAllUserDataBtn){
resetAllUserDataBtn.addEventListener('click', resetAllUserData);
}

if(bulkAddQuestionsBtn){
bulkAddQuestionsBtn.addEventListener('click', async () => {
const result = await Swal.fire({
title: 'Emin misiniz?',
text: 'Bu i≈ülem, SAMPLE_QUESTIONS dizisine eklediƒüiniz sorularƒ± Firestore\'a ekleyecek. Daha √∂nce eklenmi≈ü sorular tekrar eklenmeyecek.',
icon: 'warning',
showCancelButton: true,
confirmButtonColor: '#7c3aed',
cancelButtonColor: '#d33',
confirmButtonText: 'Evet, ekle!',
cancelButtonText: 'ƒ∞ptal',
background: '#fff9e6'
});

if (result.isConfirmed) {
await bulkAddQuestions();
}
});
}

initAdminTrigger();

soundToggleBtn.addEventListener('click', toggleSound);
settingsBtn.addEventListener('click', toggleDarkMode);



mascot.addEventListener('click', () => {
  Swal.fire({
    title: 'üéÆ Oyun Kurallarƒ±',
    html: `
      <div style="text-align: left; font-size: 0.85rem; line-height: 1.4;">
        <p style="font-size: 1.1rem; margin-bottom: 8px; color: #ff6b6b;">‚ú® Maceraya Hazƒ±r Mƒ±sƒ±n? ‚ú®</p>
        <ul style="list-style-type: none; padding: 0; margin: 0;">
          <li style="margin-bottom: 5px; background: #f9f3e7; padding: 6px 8px; border-radius: 10px;">
            ‚è≥ <strong>60 saniye</strong> ‚Äì S√ºre dolmadan cevapla!
          </li>
          <li style="margin-bottom: 5px; background: #f9f3e7; padding: 6px 8px; border-radius: 10px;">
            ‚úÖ <strong>ƒ∞lk denemede doƒüru</strong> ‚Üí +1 puan
          </li>
          <li style="margin-bottom: 5px; background: #f9f3e7; padding: 6px 8px; border-radius: 10px;">
            ‚ùå <strong>ƒ∞kinci hakkƒ±n var</strong> (yine yanlƒ±≈üta oyun biter)
          </li>
          <li style="margin-bottom: 5px; background: #f9f3e7; padding: 6px 8px; border-radius: 10px;">
            üí° <strong>ƒ∞pucu (5 puan)</strong> ‚Üí 2 yanlƒ±≈ü ≈üƒ±k elenir (seviyede bir kez)
          </li>
          <li style="margin-bottom: 5px; background: #f9f3e7; padding: 6px 8px; border-radius: 10px;">
            üöÄ <strong>Seviye atlama:</strong> Her seviyede (seviye √ó 2 + 2) soru. <br> (Seviye 1: 4 soru, Seviye 2: 6 soru, Seviye 3: 8 soru, ...)
          </li>
          <li style="margin-bottom: 5px; background: #f9f3e7; padding: 6px 8px; border-radius: 10px;">
            üèÖ <strong>Rozetler:</strong> ƒ∞lk doƒüru, seri katili (10), kategori ustalƒ±klarƒ± ve <span style="color:#7c3aed; font-weight:bold;">her 5 seviyede bir √∂zel rozet</span>!
          </li>
          <li style="margin-bottom: 5px; background: #f9f3e7; padding: 6px 8px; border-radius: 10px;">
            üéØ <strong>Hedef 50. seviye:</strong> üëë Bilge rozeti ve b√ºy√ºk s√ºrpriz!
          </li>
        </ul>
        <p style="margin-top: 10px; color: #7c3aed; font-weight: bold; text-align: center;">
          ‚ú® 50. seviyeyi bekleyen √∂zel kutlama var! ‚ú®
        </p>
      </div>
    `,
    confirmButtonText: 'Anla≈üƒ±ldƒ±',
    confirmButtonColor: '#7c3aed',
    background: document.body.classList.contains('dark-theme') ? '#2c2f33' : '#fff9f0',
    color: document.body.classList.contains('dark-theme') ? '#fff' : '#2d3e50',
    showCloseButton: true,
    showClass: { popup: 'animate__animated animate__tada' },
    hideClass: { popup: 'animate__animated animate__fadeOut' }
  });
});


            
window.addEventListener('beforeunload', () => { saveScoreToLeaderboard(); });
});
</script>
</body>
</html>


































